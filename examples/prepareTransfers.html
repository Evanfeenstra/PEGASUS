<!-- BE SURE TO HAVE SETUP PEGASUS ON DEVNET-->

<html>
<meta charset="utf-8" />

<head>
  <title>PEGASUS Prepare Transfers</title>
</head>

<body>
  <div id="output"></div>
  <input id="address" placeholder="address"/>
  <input id="amount" placeholder="amount"/>
  <input id="message" placeholder="message"/>
  <button onClick="start()">send</button>
  <button onClick="connect()">connect</button>
  <script>
    const connect = async () => {
      const outputHtml = document.querySelector("#output")

      if (!window.iota) {
        outputHtml.innerHTML += `Pegasus Not Installed`
        return
      }

      const isConnected = await window.iota.connect()
      if (isConnected) {
        outputHtml.innerHTML += `Connected`
      } else outputHtml.innerHTML += `User denied connection`
    }

    const start = async () => {
      const outputHtml = document.querySelector("#output")

      if (!window.iota) {
        outputHtml.innerHTML += `Pegasus Not Installed`
        return
      }

      const iota = window.iota

      const address = document.querySelector('#address').value
      const amount = document.querySelector('#amount').value
      const message = document.querySelector('#message').value 

      const transfers = [{
        address,
        value: parseInt(amount), 
        tag: '',
        message
      }]
      
      try {
        const bundle = await iota.core.prepareTransfers(transfers)
        outputHtml.innerHTML += `${JSON.stringify(bundle)}<br/>`
      } catch (err) {
        outputHtml.innerHTML += `Error: ${err}<br/>`
      }
    }
  </script>
</body>

</html>